<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Alex Janssen</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
      background-color: #faf8f6; color: #111; overflow-x: hidden; line-height: 1.6;
    }

    /* Intro overlay (from v5) */
    #animation-container {
      position: fixed; inset: 0; width: 100vw; height: 100vh;
      display: flex; justify-content: center; align-items: center;
      background-color: #faf8f6; z-index: 1000; transition: opacity 0.75s ease;
      cursor: pointer;
    }
    #animation-container.hidden { opacity: 0; pointer-events: none; }
    .scene { position: absolute; text-align: center; width: 90%; max-width: 800px; opacity: 0; transition: opacity 0.75s ease; }
    .scene.active { opacity: 1; }

    .greeting-word {
      font-size: clamp(3rem, 8vw, 5rem); font-weight: 300; opacity: 0;
      transform: rotateX(-90deg); transform-origin: bottom;
      animation: flipIn 0.6s ease forwards;
    }
    @keyframes flipIn { to { opacity: 1; transform: rotateX(0);} }

    .name-intro { font-size: clamp(2.5rem, 7vw, 4rem); font-weight: 300; }
    .beliefs-container { font-size: clamp(1.2rem, 3vw, 1.8rem); font-weight: 300; line-height: 1.8; }
    .belief-header { margin-bottom: 2rem; font-weight: 600; }
    .belief-item { opacity: 0; margin: 0.5rem 0; animation: fadeInUp 0.75s ease forwards; }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px);} to { opacity: 1; transform: translateY(0);} }
    .reach-out { font-size: clamp(1.3rem, 3.5vw, 2rem); font-weight: 300; line-height: 1.8; padding: 0 1rem; }
    .skip-hint { position: absolute; bottom: 24px; left: 50%; transform: translateX(-50%); font-size: 0.95rem; opacity: 0.6; }

    /* Nav (from v5) */
    nav { position: fixed; top: 0; left: 0; right: 0; background-color: #faf8f6; z-index: 999;
      padding: 1.5rem 2rem; border-bottom: 1px solid rgba(0,0,0,0.1); display: none;
    }
    nav.visible { display: block; }
    .nav-container { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
    .nav-links { display: flex; gap: 2rem; list-style: none; }
    .nav-links a { color: #111; text-decoration: none; font-size: 1.1rem; transition: opacity 0.3s; }
    .nav-links a:hover { opacity: 0.6; }
    .hamburger { display: none; flex-direction: column; cursor: pointer; gap: 4px; }
    .hamburger span { width: 25px; height: 2px; background-color: #111; transition: all 0.3s; }
    .hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
    .hamburger.active span:nth-child(2) { opacity: 0; }
    .hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(7px, -6px); }

    /* Main/Section (from v5) */
    main { display: none; padding-top: 80px; min-height: 100vh; max-width: 1200px; margin: 0 auto; padding-left: 2rem; padding-right: 2rem; }
    main.visible { display: block; }

    .section { display: none; animation: fadeIn 0.75s ease; }
    .section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    h1 { font-size: 2.5rem; font-weight: 300; margin-bottom: 2rem; }

    /* Work Section (from v5) */
    .work-item { margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 1px solid rgba(0,0,0,0.1); }
    .work-item:last-child { border-bottom: none; }
    .work-title { font-size: 1.3rem; font-weight: 600; margin-bottom: 0.5rem; }
    .work-description { color: #4a4a4a; line-height: 1.8; white-space: pre-line; }

    /* Dropdowns (from v7, with v5 colors) */
    .dropdown {
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 12px;
      background: #fff;
      overflow: hidden;
      margin-bottom: 1.2rem;
    }
    .dropdown-header {
      padding: 1rem 1.25rem;
      font-weight: 600;
      cursor: pointer;
      user-select: none;
      transition: background 0.3s;
    }
    /* Re-applied v5 color scheme to v7 IDs */
    #languages .dropdown-header { background: #ffe8f3; }
    #languages .dropdown-header:hover { background: #fbe0ee; }
    #travels .dropdown-header { background: #e8f3ff; }
    #travels .dropdown-header:hover { background: #dcefff; }
    #misc .dropdown-header { background: #fff3e8; }
    #misc .dropdown-header:hover { background: #fbead8; }
    
    .dropdown-content {
      height: 0;
      overflow: hidden;
      transition: height 0.7s ease;
    }
    .dropdown.open .dropdown-content {
      overflow: visible;
    }
    
    /* Map/Leaflet (from v7) */
    #map {
      width: 100%;
      height: 520px;
      border: 1px solid rgba(0,0,0,0.06);
      border-radius: 8px;
    }
    .hint { opacity: 0.7; font-size: 0.9rem; margin-top: 0.5rem; }

    .hovercard .leaflet-popup-content-wrapper {
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.18);
      border: 1px solid rgba(0,0,0,0.06);
    }
    .hovercard .leaflet-popup-content {
      margin: 12px 14px;
      width: 240px;
    }
    .tip-wrap { display: grid; gap: 6px; }
    .tip-title { font-weight: 700; }
    .tip-img { width: 100%; height: 120px; object-fit: cover; border-radius: 8px; display: block; }
    .tip-story { font-size: 0.9rem; opacity: 0.95; }

    /* Contact (from v5) */
    .contact-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.2rem; margin-top: 1rem; }
    .contact-item { display: flex; align-items: center; gap: 0.9rem; padding: 1rem; border-radius: 12px; background-color: #fff; transition: transform 0.25s ease, box-shadow 0.25s ease; border: 1px solid rgba(0,0,0,0.06); }
    .contact-item:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(0,0,0,0.08); }
    .contact-icon { width: 36px; height: 36px; display: grid; place-items: center; }
    .contact-item a { color: inherit; text-decoration: none; font-weight: 600; }
    .icon { width: 28px; height: 28px; fill: currentColor; }


    @media (max-width: 768px) {
      .hamburger { display: flex; }
      .nav-links {
        position: absolute; top: 100%; left: 0; right: 0; background-color: #faf8f6;
        flex-direction: column; padding: 1rem 2rem; border-bottom: 1px solid rgba(0,0,0,0.1);
        transform: translateY(-100%); opacity: 0; pointer-events: none; transition: all 0.3s ease;
      }
      .nav-links.active { transform: translateY(0); opacity: 1; pointer-events: all; }
      .beliefs-container { text-align: left; padding: 0 1rem; }
      h1 { font-size: 2rem; }
    }
  </style>
</head>
<body>
  <div id="animation-container" aria-label="intro animation (click to skip)">
    <div class="scene" id="scene1"></div>
    <div class="scene" id="scene2"><div class="name-intro">i’m alex</div></div>
    <div class="scene" id="scene3">
      <div class="beliefs-container">
        <div class="belief-header">i believe in:</div>
        <div class="belief-items"></div>
      </div>
    </div>
    <div class="scene" id="scene4">
      <div class="reach-out">
        reach out for literally any reason. i am happy to talk to anyone with an interesting perspective on the world, their work, or who just wants to chat.
      </div>
    </div>
    <div class="skip-hint">click anywhere to skip</div>
  </div>

  <nav id="main-nav" aria-label="main">
    <div class="nav-container">
      <div class="logo">alex janssen</div>
      <div class="hamburger" id="hamburger" aria-label="menu" aria-expanded="false" aria-controls="nav-links">
        <span></span><span></span><span></span>
      </div>
      <ul class="nav-links" id="nav-links">
        <li><a href="#work">work</a></li>
        <li><a href="#life">life</a></li>
        <li><a href="#contact">say hi</a></li>
      </ul>
    </div>
  </nav>

  <main id="main-content">
    <section id="work" class="section" aria-labelledby="work-head">
      <h1 id="work-head">work</h1>
      <div id="work-content"></div>
    </section>

    <section id="life" class="section" aria-labelledby="life-head">
      <h1 id="life-head">life</h1>

      <div class="dropdown" id="languages">
        <div class="dropdown-header">Languages</div>
        <div class="dropdown-content">
          <div style="padding:1rem 1.25rem;">
            Confident (~B2): Spanish, French, Russian, German<br/>
            Conversant (~A2-B1): Portuguese, Chinese, Turkish, Italian<br/>
            Quasi-Conversant (High A1): Serbian, Dutch, Arabic, Norwegian, Korean, Uzbek, Cantonese<br/>
            Flailing (Low A1): Luganda, Swahili, Farsi, Catalan, Kurdish (Kurmanji), Urdu, Thai, Japanese, Malay<br/>
            Inconceivably Abysmal: English
          </div>
        </div>
      </div>

      <div class="dropdown" id="travels">
        <div class="dropdown-header">Travels</div>
        <div class="dropdown-content">
          <div style="padding:1rem 1.25rem;">
            <div id="map"></div>
            <div class="hint">Tip: Place images like <code>fr.png</code>, <code>jp.png</code> next to this file to show photos in tooltips.</div>
          </div>
        </div>
      </div>

      <div class="dropdown" id="misc">
        <div class="dropdown-header">Miscellaneous</div>
        <div class="dropdown-content">
          <div style="padding:1rem 1.25rem;">
            <ul style="list-style-position: inside; line-height: 2;">
              <li>I got 3rd place in a Connecticut team ornithology competition.</li>
              <li>I learned how to ride a bike at age 19.</li>
              <li>I have a 1:44 half marathon time.</li>
              <li>I have bought 3 Chemexes and 4 Aeropresses in my life.</li>
              <li>Both me and my grandmother have been robbed once, both in Ulaanbaatar, Mongolia.</li>
              <li>I was possibly going to be a major role in a Connecticut community theater version of <i>As You Like It</i>. This sadly didn’t happen due to university.</li>
              <li>I did terribly in high school drawing class. Like terribly-terribly. My final project was me making a sine graph out of sticks. It took 5 minutes, and I got what I deserved.</li>
              <li>Apparently when I was a toddler, baby-Alex was in Italian Vogue. At that point, the bar for male model is “have hair.” If you represent Vogue, my inbox is open.</li>
              <li>I have a dog, she is objectively very cute. <img src="bela.png" alt="Bela" style="vertical-align: middle; height: 150px; margin-left: 10px; border-radius: 4px;"></li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <section id="contact" class="section" aria-labelledby="contact-head">
      <h1 id="contact-head">say hi</h1>
      <div class="contact-grid">
        <div class="contact-item">
          <div class="contact-icon" aria-hidden="true">
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M22 7.5V18a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V7.5l10 6 10-6Z" fill="none" stroke="currentColor" stroke-width="1.6"/>
              <rect x="2" y="4" width="20" height="16" rx="2" fill="none" stroke="currentColor" stroke-width="1.6"/>
            </svg>
          </div>
          <a href="mailto:alexpjanssen@gmail.com">alexpjanssen@gmail.com</a>
        </div>
        <div class="contact-item">
          <div class="contact-icon" aria-hidden="true">
            <svg class="icon" viewBox="0 0 24 24">
              <rect x="3" y="3" width="18" height="18" rx="5" fill="none" stroke="currentColor" stroke-width="1.6"/>
              <circle cx="12" cy="12" r="4.5" fill="none" stroke="currentColor" stroke-width="1.6"/>
              <circle cx="17.5" cy="6.5" r="1.2" fill="currentColor"/>
            </svg>
          </div>
          <a href="https://instagram.com/ajanss606" target="_blank" rel="noopener">@ajanss606</a>
        </div>
        <div class="contact-item">
          <div class="contact-icon" aria-hidden="true">
            <svg class="icon" viewBox="0 0 24 24">
              <rect x="3" y="8" width="4" height="13" fill="currentColor"/>
              <circle cx="5" cy="5" r="2" fill="currentColor"/>
              <path d="M11 8h4a5 5 0 0 1 5 5v8h-4v-7c0-1.7-1.3-3-3-3h-2v10h-4V8h4Z" fill="currentColor"/>
            </svg>
          </div>
          <a href="https://www.linkedin.com/in/alexpjanssen/" target="_blank" rel="noopener">LinkedIn</a>
        </div>
        <div class="contact-item">
          <div class="contact-icon" aria-hidden="true">
            <svg class="icon" viewBox="0 0 24 24">
              <rect x="3" y="6" width="18" height="12" rx="3" fill="none" stroke="currentColor" stroke-width="1.6"/>
              <path d="M10 9.5v5l5-2.5-5-2.5z" fill="#ffffff" stroke="currentColor" stroke-width="0.6"/>
            </svg>
          </div>
          <a href="https://www.youtube.com/@Forastersoc" target="_blank" rel="noopener">travel vlog</a>
        </div>
      </div>
    </section>
  </main>

  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
  
  <script>
    // Config (from v5)
    const CONFIG = {
      GREETING_WORD_DURATION: 500,
      BELIEF_STAGGER_DELAY: 450,
      SCENE_GAP: 750,
      ANIMATION_LOOP_DELAY: 1200
    };

    const greetings = ['hi','salut','hola','olá','привет','здраво','merhaba','hallo','你好','ciao','hej','أهلا','سلام','salom','përshëndetje','silav'];
    const beliefs = [
      'tech in service of all people',
      'using language to experiment and connect and entertain and convince and…',
      'open-minded travel in my neighborhood, around the world to learn about us people',
      'a sense of place',
      'forcing children to learn a musical instrument',
      'wide reading and notetaking about anything remotely interesting',
      'being remotely interested in anything, being very interested in everyone'
    ];
    const workData = [
      { title: "Software Engineer - Roblox (August 2025-Present)", description: "Backend software for ads infra. A/B testing and performance profiling in Golang, C#, React." },
      { title: "Software Engineering Internships - Roblox (Summer 2023, 2024)", description: "Two full-stack projects:\n2023, C++ and Lua code for ads and subscription products. UI design, cross-collaboration with data science, designers, and software engineers on other orgs.\n2024, Golang and React code for ads targeting credit card fraud. UI design and microservices logic. Telemetry. 12 cups of coffee in one day!" },
      { title: "Research Interests", description: "Programming language theory:\nTwo research stints in programming language theory. One developing a C-like language for resource constrained microprocessors for Ray Simar. One developing a type-script like Javascript dialect with sound type systems at Hong Kong University of Science and Technology with Lionel Parreaux.\n\nModern Central Asian Linguistic Politics:\nSenior thesis on Uzbek negotiations between a Russian sphere of influence and intersecting Turkic nationalisms as seen through Uzbek latinization of its alphabet.\n\nPost-1949 Chinese Politics:\nTwo substantial papers, one comparing the Cuban and Chinese relationship with the USSR and another arguing for a model of three eras of Chinese rural development post-Civil War." },
      { title: "Education", description: "Rice University (2021-2025)\nBachelor of Science in Computer Science, Bachelor of Arts in Medieval Studies, Transnational Asia Studies\n3.96/4.0, Magna Cum Laude, Distinction in Creative Works and Research\n\nHong Kong University of Science and Technology (Fall 2023)\n3.85/4.0, Deans List (Top 5% of Students)" }
    ];

    // --- MAP CODE (MOVED OUTSIDE DOMCONTENTLOADED) ---
    
    let mapInitialized = false;

    const visited = [
      { code:'dz', name:'Algeria', lon:2.6, lat:28.0 },
      { code:'ar', name:'Argentina', lon:-64.0, lat:-34.0 },
      { code:'am', name:'Armenia', lon:44.8, lat:40.3 },
      { code:'at', name:'Austria', lon:14.5, lat:47.6 },
      { code:'az', name:'Azerbaijan', lon:47.6, lat:40.4 },
      { code:'ba', name:'Bosnia', lon:17.8, lat:44.2 },
      { code:'bn', name:'Brunei', lon:114.7, lat:4.5 },
      { code:'bg', name:'Bulgaria', lon:25.2, lat:42.7 },
      { code:'kh', name:'Cambodia', lon:104.9, lat:12.6 },
      { code:'ca', name:'Canada', lon:-98.3, lat:56.1 },
      { code:'cn', name:'China', lon:104.2, lat:35.8 },
      { code:'cr', name:'Costa Rica', lon:-84.0, lat:9.9 },
      { code:'hr', name:'Croatia', lon:16.4, lat:45.1 },
      { code:'cu', name:'Cuba', lon:-79.3, lat:21.6 },
      { code:'cz', name:'Czechia', lon:15.4, lat:49.8 },
      { code:'sv', name:'El Salvador', lon:-88.9, lat:13.8 },
      { code:'gb', name:'England', lon:-1.5, lat:52.4 },
      { code:'fr', name:'France', lon:2.6, lat:46.5 },
      { code:'ge', name:'Georgia', lon:43.4, lat:42.0 },
      { code:'de', name:'Germany', lon:10.4, lat:51.1 },
      { code:'hk', name:'Hong Kong', lon:114.1, lat:22.3 },
      { code:'hu', name:'Hungary', lon:19.4, lat:47.1 },
      { code:'it', name:'Italy', lon:12.6, lat:42.8 },
      { code:'jp', name:'Japan', lon:138.2, lat:37.6 },
      { code:'kz', name:'Kazakhstan', lon:66.9, lat:48.2 },
      { code:'kw', name:'Kuwait', lon:47.5, lat:29.4 },
      { code:'kg', name:'Kyrgyzstan', lon:74.7, lat:41.5 },
      { code:'li', name:'Liechtenstein', lon:9.5, lat:47.1 },
      { code:'mo', name:'Macau', lon:113.5, lat:22.2 },
      { code:'my', name:'Malaysia', lon:102.2, lat:4.2 },
      { code:'mx', name:'Mexico', lon:-102.6, lat:23.9 },
      { code:'mn', name:'Mongolia', lon:103.8, lat:46.8 },
      { code:'ma', name:'Morocco', lon:-6.3, lat:31.8 },
      { code:'pe', name:'Peru', lon:-75.0, lat:-9.2 },
      { code:'pt', name:'Portugal', lon:-8.2, lat:39.6 },
      { code:'qa', name:'Qatar', lon:51.2, lat:25.3 },
      { code:'ru', name:'Russia', lon:96.5, lat:61.5 },
      { code:'rw', name:'Rwanda', lon:29.9, lat:-1.9 },
      { code:'sn', name:'Senegal', lon:-14.5, lat:14.5 },
      { code:'rs', name:'Serbia', lon:20.8, lat:44.0 },
      { code:'sg', name:'Singapore', lon:103.8, lat:1.35 },
      { code:'si', name:'Slovenia', lon:14.8, lat:46.1 },
      { code:'es', name:'Spain', lon:-3.7, lat:40.3 },
      { code:'lk', name:'Sri Lanka', lon:80.7, lat:7.8 },
      { code:'sr', name:'Suriname', lon:-55.9, lat:4.1 },
      { code:'ch', name:'Switzerland', lon:8.2, lat:46.8 },
      { code:'tj', name:'Tajikistan', lon:71.0, lat:38.6 },
      { code:'th', name:'Thailand', lon:100.8, lat:15.8 },
      { code:'tn', name:'Tunisia', lon:9.5, lat:34.1 },
      { code:'tr', name:'Türkiye', lon:35.1, lat:39.1 },
      { code:'tm', name:'Turkmenistan', lon:59.4, lat:38.9 },
      { code:'ug', name:'Uganda', lon:32.3, lat:1.4 },
      { code:'us', name:'United States', lon:-98.0, lat:39.8 },
      { code:'uz', name:'Uzbekistan', lon:63.5, lat:41.4 },
      { code:'va', name:'Vatican', lon:12.45, lat:41.90 }
    ];
    
    const style = { radius: 6, color:'#b22522', weight:1, fillColor:'#e53935', fillOpacity:0.9 };

    function attachHoverCard(circleMarker, html) {
      let popup = null;
      let hideTimer = null;
      function showPopup() {
        clearTimeout(hideTimer);
        if (!popup) {
          popup = L.popup({
            closeButton:false,
            autoPan:false,
            offset:[0,-8],
            className:'hovercard'
          })
          .setLatLng(circleMarker.getLatLng())
          .setContent(html)
          .openOn(window._leafletMap); // Use global map
          const container = popup.getElement();
          container.addEventListener('mouseenter', () => clearTimeout(hideTimer));
          container.addEventListener('mouseleave', scheduleHide);
        }
      }
      function scheduleHide() {
        clearTimeout(hideTimer);
        hideTimer = setTimeout(() => {
          if (popup) {
            window._leafletMap.closePopup(popup);
            popup = null;
          }
        }, 250);
      }
      circleMarker.on('mouseover', showPopup);
      circleMarker.on('mouseout', scheduleHide);
      circleMarker.on('click', () => {
        if (popup) { window._leafletMap.closePopup(popup); popup=null; } else showPopup();
      });
    }

    function initializeMap() {
      // This function will only run once
      if (mapInitialized || !document.getElementById('map')) return;
      mapInitialized = true;

      console.log("Initializing Leaflet Map...");
      const map = L.map('map', { worldCopyJump: true, zoomControl: true });
      window._leafletMap = map; // Store globally
      map.setView([20, 0], 2);
      L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        maxZoom: 8, minZoom: 2,
        attribution: '&copy; <a href="https://carto.com/">CARTO</a> | &copy; OpenStreetMap contributors'
      }).addTo(map);

      visited.forEach(p => {
        const marker = L.circleMarker([p.lat, p.lon], style).addTo(map);
        const html = `
          <div class="tip-wrap">
            <div class="tip-title">${p.name}</div>
            <img class="tip-img" src="${p.code}.png" alt="${p.name}" onerror="this.style.display='none'">
            <div class="tip-story">travel story: (add your story about ${p.name})</div>
          </div>`;
        attachHoverCard(marker, html);
      });
    }
    // --- END OF MOVED MAP CODE ---


    // Intro animation (from v5, with FIX for scene1)
    class AnimationController {
      constructor() {
        this.animationContainer = document.getElementById('animation-container');
        this.isStopped = false;
        this.animationContainer.addEventListener('click', () => this.stop());
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') this.stop(); });
      }

      // --- THIS FUNCTION IS FIXED ---
      async playScene1() {
        const scene = document.getElementById('scene1');
        scene.classList.add('active');
        
        for (let i = 0; i < greetings.length; i++) {
          if (this.isStopped) return;
          
          // Create a new element for each word
          // This avoids the "force reflow" hack and browser bugs
          const wordContainer = document.createElement('div');
          wordContainer.className = 'greeting-word';
          wordContainer.textContent = greetings[i];
          
          // Clear the scene and add the new word
          scene.innerHTML = '';
          scene.appendChild(wordContainer);
          
          await this.delay(CONFIG.GREETING_WORD_DURATION);
        }
        scene.classList.remove('active');
      }
      // --- END OF FIX ---

      async playScene2() { if (this.isStopped) return; const s = document.getElementById('scene2'); s.classList.add('active'); await this.delay(3000); s.classList.remove('active'); }
      async playScene3() {
        if (this.isStopped) return;
        const s = document.getElementById('scene3');
        const c = s.querySelector('.belief-items'); c.innerHTML = ''; s.classList.add('active');
        for (let i = 0; i < beliefs.length; i++) {
          const el = document.createElement('div'); el.className = 'belief-item'; el.textContent = beliefs[i];
          el.style.animationDelay = `${i * CONFIG.BELIEF_STAGGER_DELAY}ms`; c.appendChild(el);
        }
        const total = (beliefs.length - 1) * CONFIG.BELIEF_STAGGER_DELAY + 1800; await this.delay(total); s.classList.remove('active');
      }
      async playScene4() { if (this.isStopped) return; const s = document.getElementById('scene4'); s.classList.add('active'); await this.delay(3750); s.classList.remove('active'); }
      async startOnceThenStop() { await this.playScene1(); await this.delay(CONFIG.SCENE_GAP); await this.playScene2(); await this.delay(CONFIG.SCENE_GAP); await this.playScene3(); await this.delay(CONFIG.SCENE_GAP); await this.playScene4(); await this.delay(CONFIG.ANIMATION_LOOP_DELAY); if (!this.isStopped) this.stop(); }
      delay(ms){ return new Promise(res=>setTimeout(res, Math.max(0, ms))); }
      stop(){ if (this.isStopped) return; this.isStopped = true; this.animationContainer.classList.add('hidden'); document.getElementById('main-nav').classList.add('visible'); document.getElementById('main-content').classList.add('visible'); showSection((location.hash || '#work').replace('#','') || 'work'); }
    }

    // Navigation (from v5)
    function initNavigation() {
      const hamburger = document.getElementById('hamburger');
      const navLinks = document.getElementById('nav-links');
      hamburger.addEventListener('click', () => {
        const active = hamburger.classList.toggle('active');
        navLinks.classList.toggle('active');
        hamburger.setAttribute('aria-expanded', active ? 'true' : 'false');
      });
      document.querySelectorAll('.nav-links a').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const id = link.getAttribute('href').substring(1);
          showSection(id);
          history.replaceState(null, '', '#' + id);
          hamburger.classList.remove('active');
          navLinks.classList.remove('active');
          hamburger.setAttribute('aria-expanded', 'false');
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
      });
    }
    function showSection(id){ document.querySelectorAll('.section').forEach(s=>s.classList.remove('active')); const el=document.getElementById(id); if(el) el.classList.add('active'); }

    // Work content (from v5)
    function loadWorkContent() {
      const box = document.getElementById('work-content');
      workData.forEach(item => {
        const div = document.createElement('div');
        div.className = 'work-item';
        div.innerHTML = `<div class="work-title">${item.title}</div><div class="work-description">${item.description}</div>`;
        box.appendChild(div);
      });
    }

    // Boot
    document.addEventListener('DOMContentLoaded', () => {
      initNavigation();
      loadWorkContent();
      
      // --- Dropdown Logic (Auto-Collapse) ---
      const dropdowns = document.querySelectorAll('.dropdown');
      dropdowns.forEach(d => {
        const header = d.querySelector('.dropdown-header');
        const content = d.querySelector('.dropdown-content');

        // Store the state on the element itself
        d.isOpen = false;
        d.isAnimating = false;

        header.addEventListener('click', () => {
          if (d.isAnimating) return;
          const openNow = !d.isOpen;
          
          // Close other dropdowns
          dropdowns.forEach(other => {
            if (other !== d) closeDropdown(other);
          });
          
          // Open or close the current one
          if (openNow) openDropdown(d); else closeDropdown(d);
        });

        function openDropdown(el) {
          const c = el.querySelector('.dropdown-content');
          if (el.isAnimating || el.isOpen) return;

          el.isAnimating = true;
          el.classList.add('open');
          
          c.style.height = 'auto';
          const endHeight = c.offsetHeight;
          c.style.height = '0px';
          
          requestAnimationFrame(() => {
            c.style.height = endHeight + 'px';
          });

          // --- THIS IS THE PATCHED SECTION ---
          setTimeout(() => {
            c.style.height = 'auto';
            el.isAnimating = false;
            el.isOpen = true;
            
            // --- MAP FIX ---
            if (el.id === 'travels') {
              // This will create the map on the first click
              initializeMap(); 
              
              // This will resize it every time it's opened
              if (window._leafletMap) {
                window._leafletMap.invalidateSize();
              }
            }
            // --- END MAP FIX ---
            
          }, 700); // Match CSS transition
          // --- END OF PATCH ---
        }

        function closeDropdown(el) {
          const c = el.querySelector('.dropdown-content');
          if (el.isAnimating || !el.isOpen) return;

          el.isAnimating = true;
          el.isOpen = false;
          
          const startHeight = c.offsetHeight;
          c.style.height = startHeight + 'px';
          
          el.classList.remove('open');
          
          requestAnimationFrame(() => {
            c.style.height = '0px';
          });

          setTimeout(() => {
            el.isAnimating = false;
          }, 700); // Match CSS transition
        }
      });
      
      // --- OLD MAP CODE IS DELETED FROM HERE ---

      // Start v5 intro animation
      const controller = new AnimationController();
      controller.startOnceThenStop();
    });
  </script>
</body>
</html>